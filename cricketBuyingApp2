
class kitsBuyActivity : AppCompatActivity(),PaymentResultListener{
    private lateinit var binding: ActivityKitsBuyBinding
    private lateinit var firestore: FirebaseFirestore
    var price:String?=""
    var tittle:String? = ""
    var kitData:String? = ""

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityKitsBuyBinding.inflate(layoutInflater)
        setContentView(binding.root)
        firestore = Firebase.firestore

        val img = intent.getStringExtra("img")
         tittle = intent.getStringExtra("tittle")
        val description = intent.getStringExtra("description")
         price = intent.getStringExtra("price")
        val kitBought = intent.getStringExtra("kitBought")
         kitData = intent.getStringExtra("kitData")

        Glide.with(application).load(img).into(binding.kitBuyImg)
        binding.kitBuyTittle.text = tittle.toString()
        binding.kitBuyPrice.text = "Rs.$price"
        binding.kitBuyDes.text = description.toString()

        if (kitBought.equals("no", ignoreCase = true)){
            binding.buyNow.text = "buyNow"
            binding.buyNow.setOnClickListener {
                startPayment()
            }
        }
        else{
            binding.buyNow.text = "viewCourse"
            binding.buyNow.setOnClickListener{
                val i = Intent(this,informationActivity::class.java)
                i.putExtra("information",kitData)
                startActivity(i)
            }
        }

    }
    private fun startPayment() {
        /*
        *  You need to pass the current activity to let Razorpay create CheckoutActivity
        * */
        val activity: Activity = this
        val co = Checkout()

        val amountInSubunits = price?.toInt()
        val resultAmount = amountInSubunits!!*100


        try {
            val options = JSONObject()
            options.put("name","MRF kits private Limited")
            options.put("description",tittle)
            //You can omit the image option to fetch the image from the dashboard
            options.put("image","http://example.com/image/rzp.jpg")
            options.put("theme.color", "#3399cc");
            options.put("currency","INR");

            options.put("amount",resultAmount.toString())//pass amount in currency subunits



            val prefill = JSONObject()
            prefill.put("email","gaurav.kumar@example.com")
            prefill.put("contact","9876543210")

            options.put("prefill",prefill)
            co.open(activity,options)
        }catch (e: Exception){
            Toast.makeText(activity,"Error in payment: "+ e.message,Toast.LENGTH_LONG).show()
            e.printStackTrace()
        }
    }

    